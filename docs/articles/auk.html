<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>auk: eBird Data Extraction with AWK • auk</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="auk: eBird Data Extraction with AWK">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">auk</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/auk.html">Vignette</a>
</li>
<li>
  <a href="../reference/index.html">Function Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/CornellLabofOrnithology/auk">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>auk: eBird Data Extraction with AWK</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CornellLabofOrnithology/auk/blob/master/vignettes/auk.Rmd"><code>vignettes/auk.Rmd</code></a></small>
      <div class="hidden name"><code>auk.Rmd</code></div>

    </div>

    
    
<p><a href="http://www.ebird.org">eBird</a> is an online tool for recording bird observations. Since its inception, nearly 500 million records of bird sightings (i.e. combinations of location, date, time, and bird species) have been collected, making eBird one of the largest citizen science projects in history and an extremely valuable resource for bird research and conservation. The full eBird database is packaged as a text file and available for download as the <a href="http://ebird.org/ebird/data/download">eBird Basic Dataset (EBD)</a>. Due to the large size of this dataset, it must be filtered to a smaller subset of desired observations before reading into R. This filtering is most efficiently done using AWK, a Unix utility and programming language for processing column formatted text data. This package acts as a front end for AWK, allowing users to filter eBird data before import into R.</p>
<p>This vignette is divided into three sections. The first section provides background on the eBird data and motivation for the development of this package. The second section outlines the use of <code>auk</code> for filtering text file to produce a presence-only dataset. The final section demonstrates how <code>auk</code> can be used to produce zero-filled, presence-absence (or more correctly presence–non-detection) data, a necessity for many modeling and analysis applications.</p>
<div id="quick-start" class="section level2">
<h2 class="hasAnchor">
<a href="#quick-start" class="anchor"></a>Quick start</h2>
<p>This package uses the command-line program AWK to extract subsets of the eBird Basic Dataset for use in R. This is a multi-step process:</p>
<ol style="list-style-type: decimal">
<li>Define a reference to the eBird data file.</li>
<li>Define a set of spatial, temporal, or taxonomic filters. Each type of filter corresponds to a different function, e.g. <code>auk_species</code> to filter by species. At this stage the filters are only set up, no actual filtering is done until the next step.</li>
<li>Filter the eBird data text file, producing a new text file with only the selected rows.</li>
<li>Import this text file into R as a data frame.</li>
</ol>
<p>Because the eBird dataset is so large, step 3 typically takes several hours to run. Here’s a simple example that extract all Gray Jay records from within Canada.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(auk)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co"># path to the ebird data file, here a sample included in the package</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># in practice, provide path to ebd, e.g. input_file &lt;- "data/ebd_relFeb-2018.txt"</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">input_file &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata/ebd-sample.txt"</span>, <span class="dt">package =</span> <span class="st">"auk"</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co"># output text file</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">output_file &lt;-<span class="st"> "ebd_filtered_grja.txt"</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">ebird_data &lt;-<span class="st"> </span>input_file <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="st">  </span><span class="co"># 1. reference file</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="../reference/auk_ebd.html">auk_ebd</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="st">  </span><span class="co"># 2. define filters</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="../reference/auk_species.html">auk_species</a></span>(<span class="dt">species =</span> <span class="st">"Gray Jay"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="../reference/auk_country.html">auk_country</a></span>(<span class="dt">country =</span> <span class="st">"Canada"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="st">  </span><span class="co"># 3. run filtering</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="../reference/auk_filter.html">auk_filter</a></span>(<span class="dt">file =</span> output_file) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="st">  </span><span class="co"># 4. read text file into r data frame</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="../reference/read_ebd.html">read_ebd</a></span>()</a></code></pre></div>
<p>For those not familiar with the pipe operator (<code>%&gt;%</code>), the above code could be rewritten:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">input_file &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata/ebd-sample.txt"</span>, <span class="dt">package =</span> <span class="st">"auk"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">output_file &lt;-<span class="st"> "ebd_filtered_grja.txt"</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">ebd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/auk_ebd.html">auk_ebd</a></span>(input_file)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">ebd_filters &lt;-<span class="st"> </span><span class="kw"><a href="../reference/auk_species.html">auk_species</a></span>(ebd, <span class="dt">species =</span> <span class="st">"Gray Jay"</span>)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">ebd_filters &lt;-<span class="st"> </span><span class="kw"><a href="../reference/auk_country.html">auk_country</a></span>(ebd_filters, <span class="dt">country =</span> <span class="st">"Canada"</span>)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">ebd_filtered &lt;-<span class="st"> </span><span class="kw"><a href="../reference/auk_filter.html">auk_filter</a></span>(ebd_filters, <span class="dt">file =</span> output_file)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">ebd_df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_ebd.html">read_ebd</a></span>(ebd_filtered)</a></code></pre></div>
</div>
<div id="background" class="section level2">
<h2 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h2>
<div id="the-ebird-basic-dataset" class="section level3">
<h3 class="hasAnchor">
<a href="#the-ebird-basic-dataset" class="anchor"></a>The eBird Basic Dataset</h3>
<p>The eBird database currently contains nearly 500 million bird observations, and this rate of increase is accelerating as new users join eBird. These data are an extremely valuable tool both for basic science and conservation; however, given the sheer amount of data, accessing eBird data poses a unique challenge. Currently, access to the complete set of eBird observations is provided via the eBird Basic Dataset (EBD). This is a tab-separated text file, released quarterly, containing all validated bird sightings in the eBird database at the time of release. Each row corresponds to the sighting of a single species within a checklist and, in addition to the species and number of individuals reported, information is provided at the checklist level (location, time, date, search effort, etc.).</p>
<p>In addition, eBird provides a Sampling Event Data file that contains the checklist-level data for every valid checklist submitted to eBird, including checklists for which no species of birds were reported. In this file, each row corresponds to a checklist and only the checklist-level variables are included, not the associated bird data. While the eBird Basic Dataset provides presence-only data, it can be combined with the Sampling Event Data file to produce presence-absence data. This process is described below.</p>
<p>For full metadata on the both datasets, consult the documentation provided when the <a href="http://ebird.org/ebird/data/download">files are downloaded</a>.</p>
</div>
</div>
<div id="auk-vs--rebird" class="section level2">
<h2 class="hasAnchor">
<a href="#auk-vs--rebird" class="anchor"></a><code>auk</code> vs. <code>rebird</code>
</h2>
<p>Those interested in eBird data may also want to consider <a href="https://github.com/ropensci/rebird"><code>rebird</code></a>, an R package that provides an interface to the <a href="https://confluence.cornell.edu/display/CLOISAPI/eBirdAPIs">eBird APIs</a>. The functions in <code>rebird</code> are mostly limited to accessing recent (i.e. within the last 30 days) observations, although <code>ebirdfreq()</code> does provide historical frequency of observation data. In contrast, <code>auk</code> gives access to the full set of ~ 500 million eBird observations. For most ecological applications, users will require <code>auk</code>; however, for some use cases, e.g. building tools for birders, <code>rebird</code> provides a quick and easy way to access data.</p>
<div id="data-access" class="section level3">
<h3 class="hasAnchor">
<a href="#data-access" class="anchor"></a>Data access</h3>
<p>To access eBird data, begin by <a href="https://secure.birds.cornell.edu/cassso/login">creating an eBird account and signing in</a>. Then visit the <a href="http://ebird.org/ebird/data/download">Download Data</a> page. eBird data access is free; however, you will need to <a href="http://ebird.org/ebird/data/request">request access</a> in order to obtain access to the EBD. Filling out the access request form allows eBird to keep track of the number of people using the data and obtain information on the applications for which the data are used</p>
<p>Once you have access to the data, proceed to the <a href="http://ebird.org/ebird/data/download/ebd">download page</a>. There are two download options: prepackage download and custom download. Downloading the prepackaged option gives you access to the full global dataset. If you choose this route, you’ll likely want to download both the EBD (~ 25 GB) and corresponding Sampling Event Data (~ 2.5 GB). If you know you’re likely to only need data for a single species, or a small region, you can request a custom download be prepared consisting of only a subset of the data. This will result in significantly smaller files; however, note that custom requests that would result in huge numbers of checklists (e.g. all records from the US) won’t work. In either case, download and decompress the files.</p>
</div>
<div id="example-data" class="section level3">
<h3 class="hasAnchor">
<a href="#example-data" class="anchor"></a>Example data</h3>
<p>This package comes with two example datasets. The first is suitable for practicing filtering the EBD and producing presence-only data. It’s a sample of 500 records from the EBD. It contains data from North and Central America from 2010-2012 on 4 jay species: Gray Jay, Blue Jay, Steller’s Jay, and Green Jay. It can be accessed with:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">library</span>(auk)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw">system.file</span>(<span class="st">"extdata/ebd-sample.txt"</span>, <span class="dt">package =</span> <span class="st">"auk"</span>)</a></code></pre></div>
<p>The second is suitable for producing zero-filled, presence-absence data. It contains every sighting from Singapore in 2012 of Collared Kingfisher, White-throated Kingfisher, and Blue-eared Kingfisher. The full Sampling Event Data file is also included, and contains all checklists from Singapore in 2012. These files can be accessed with:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># ebd</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">system.file</span>(<span class="st">"extdata/zerofill-ex_ebd.txt"</span>, <span class="dt">package =</span> <span class="st">"auk"</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co"># sampling event data</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="kw">system.file</span>(<span class="st">"extdata/zerofill-ex_sampling.txt"</span>, <span class="dt">package =</span> <span class="st">"auk"</span>)</a></code></pre></div>
<p><strong>Important note:</strong> in this vignette, <code>system.file()</code> is used to return the path to the example data included in this package. When using <code>auk</code> in practice, provide the path to the location of the EBD on your computer, this could be a relative path, e.g. <code>"data/ebd_relFeb-2018.txt"</code>, or an absolute path, e.g. <code>"~/ebird/ebd_relFeb-2018/ebd_relFeb-2018.txt"</code>.</p>
</div>
<div id="awk" class="section level3">
<h3 class="hasAnchor">
<a href="#awk" class="anchor"></a>AWK</h3>
<p>R typically works with objects in memory and, as a result, there is a hard limit on the size of objects that can be brought into R. Because eBird contains nearly 500 million sightings, the eBird Basic Dataset is an inherently large file (~150 GB uncompressed) and therefore impossible to manipulate directly in R. Thus it is generally necessary to create a subset of the file outside of R, then import this smaller subset for analysis.</p>
<p>AWK is a Unix utility and programming language for processing column formatted text data. It is highly flexible and extremely fast, making it a valuable tool for pre-processing the eBird data in order to create the smaller subset of data that is required. Users of the data can use AWK to produce a smaller file, subsetting the full text file taxonomically, spatially, or temporally, in order to produce a smaller file that can then be loaded in to R for visualization, analysis, and modelling.</p>
<p>Although AWK is a powerful tool, it has three disadvantages: it requires learning the syntax of a new language, it is only accessible via the command line, and it results in a portion of your workflow existing outside of R. This package is a wrapper for AWK specifically designed for filtering eBird data The goal is to ease the use of the this data by removing the hurdle of learning and using AWK.</p>
<p>Linux and Mac users should already have AWK installed on their machines, however, Windows uses will need to install <a href="https://www.cygwin.com">Cygwin</a> to gain access to AWK. Note that <strong>Cygwin should be installed in the default location</strong> (<code>C:/cygwin/bin/gawk.exe</code> or <code>C:/cygwin64/bin/gawk.exe</code>) in order for <code>auk</code> to work. To check that AWK is installed and can be found run <code>auk_getpath()</code>.</p>
<p>If AWK is installed in a non-standard location, or can’t be found by <code>auk</code>, you can manually set the path to AWK. To do so, set the <code>AWK_PATH</code> environment in your <code>.Renviron</code> file. For example, Mac and Linux users might add the following line:</p>
<pre><code>AWK_PATH=/usr/bin/awk</code></pre>
<p>while Windows users might add:</p>
<pre><code>AWK_PATH=C:/cygwin64/bin/gawk.exe</code></pre>
</div>
<div id="a-note-on-versions" class="section level3">
<h3 class="hasAnchor">
<a href="#a-note-on-versions" class="anchor"></a>A note on versions</h3>
<p>This package contains a current (as of the time of package release) version of the <a href="http://help.ebird.org/customer/portal/articles/1006825-the-ebird-taxonomy">bird taxonomy used by eBird</a>. This taxonomy determines the species that can be reported in eBird and therefore the species that users of <code>auk</code> can extract from the EBD. eBird releases an updated taxonomy once a year, typically in August, at which time <code>auk</code> will be updated to include the current taxonomy. When using <code>auk</code>, users should be careful to ensure that the version they’re using is in sync with the EBD file they’re working with. This is most easily accomplished by always using the most recent version of <code>auk</code> and the most recent release of the eBird Basic Dataset</p>
</div>
</div>
<div id="presence-data" class="section level2">
<h2 class="hasAnchor">
<a href="#presence-data" class="anchor"></a>Presence data</h2>
<p>The most common use of the eBird data is to produce a set of bird sightings, i.e. where and when was a given species seen. For example, this type of data could be used to produce a map of sighting locations, or to determine if a given bird has been seen in an area of interest. For more analytic work, such as species distribution modeling, presence and absence data are likely preferred (see Guillera-Arroita et al. 2015). Producing presence-absence data will be covered in the next section.</p>
<div id="cleaning" class="section level3">
<h3 class="hasAnchor">
<a href="#cleaning" class="anchor"></a>Cleaning</h3>
<p>Some rows in the eBird Basic Dataset may have an incorrect number of columns, typically from problematic characters in the comments fields, and the dataset has an extra blank column at the end. The function <code><a href="../reference/auk_clean.html">auk_clean()</a></code> drops these erroneous records and removes the blank column. This process should be run on both the EBD and sampling event data. It typically takes several hours for the full EBD; however, it only needs to be run once because the output from the process is saved out to a new tab-separated text file for subsequent and potentially repeated use.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">library</span>(auk)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co"># sample data, with intentially introduced errors</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">f &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata/ebd-sample_messy.txt"</span>, <span class="dt">package =</span> <span class="st">"auk"</span>)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">f_out &lt;-<span class="st"> "ebd_cleaned.txt"</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co"># remove problem records</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">cleaned &lt;-<span class="st"> </span><span class="kw"><a href="../reference/auk_clean.html">auk_clean</a></span>(f, <span class="dt">f_out =</span> f_out)</a></code></pre></div>
</div>
<div id="the-auk_ebd-object" class="section level3">
<h3 class="hasAnchor">
<a href="#the-auk_ebd-object" class="anchor"></a>The <code>auk_ebd</code> object</h3>
<p>This package uses an <code>auk_ebd</code> object to keep track of the input data file, any filters defined, and the output file that is produced after filtering has been executed. By keeping everything wrapped up in one object, the user can keep track of exactly what set of input data and filters produced any given output data. To set up the initial <code>auk_ebd</code> object, use <code><a href="../reference/auk_ebd.html">auk_ebd()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">ebd &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata/ebd-sample.txt"</span>, <span class="dt">package =</span> <span class="st">"auk"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/auk_ebd.html">auk_ebd</a></span>()</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">ebd</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; Input </span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt;   EBD: /Users/mes335/Library/R/3.5/library/auk/extdata/ebd-sample.txt </span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt; Output </span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt;   Filters not executed</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt; Filters </span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt;   Species: all</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt;   Countries: all</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt;   States: all</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt;   BCRs: all</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt;   Spatial extent: full extent</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt;   Date: all</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt;   Start time: all</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">#&gt;   Last edited date: all</span></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="co">#&gt;   Protocol: all</span></a>
<a class="sourceLine" id="cb8-20" data-line-number="20"><span class="co">#&gt;   Project code: all</span></a>
<a class="sourceLine" id="cb8-21" data-line-number="21"><span class="co">#&gt;   Duration: all</span></a>
<a class="sourceLine" id="cb8-22" data-line-number="22"><span class="co">#&gt;   Distance travelled: all</span></a>
<a class="sourceLine" id="cb8-23" data-line-number="23"><span class="co">#&gt;   Records with breeding codes only: no</span></a>
<a class="sourceLine" id="cb8-24" data-line-number="24"><span class="co">#&gt;   Complete checklists only: no</span></a></code></pre></div>
</div>
<div id="defining-filters" class="section level3">
<h3 class="hasAnchor">
<a href="#defining-filters" class="anchor"></a>Defining filters</h3>
<p><code>auk</code> uses a <a href="http://r4ds.had.co.nz/pipes.html">pipeline-based workflow</a> for defining filters, which can then be compiled into an AWK script. Any of the following filters can be applied:</p>
<ul>
<li>
<code><a href="../reference/auk_species.html">auk_species()</a></code>: filter by species using common or scientific names.</li>
<li>
<code><a href="../reference/auk_country.html">auk_country()</a></code>: filter by country using the standard English names or <a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2">ISO 2-letter country codes</a>.</li>
<li>
<code><a href="../reference/auk_state.html">auk_state()</a></code>: filter by state using the eBird state codes, see <code><a href="../reference/ebird_states.html">?ebird_states</a></code>.</li>
<li>
<code><a href="../reference/auk_bcr.html">auk_bcr()</a></code>: filter by <a href="http://nabci-us.org/resources/bird-conservation-regions/">Bird Conservation Region (BCR)</a> using BCR codes, see <code><a href="../reference/bcr_codes.html">?bcr_codes</a></code>.</li>
<li>
<code><a href="../reference/auk_extent.html">auk_extent()</a></code>: filter by spatial extent, i.e. a range of latitudes and longitudes in decimal degrees.</li>
<li>
<code><a href="../reference/auk_date.html">auk_date()</a></code>: filter to checklists from a range of dates. To extract observations from a range of dates, regardless of year, use the wildcard “<code>*</code>” in place of the year, e.g. <code>date = c("*-05-01", "*-06-30")</code> for observations from May and June of any year.</li>
<li>
<code><a href="../reference/auk_last_edited.html">auk_last_edited()</a></code>: filter to checklists from a range of last edited dates, useful for extracting just new or recently edited data.</li>
<li>
<code><a href="../reference/auk_protocol.html">auk_protocol()</a></code>: filter to checklists that following a specific search protocol, either stationary, traveling, or casual.</li>
<li>
<code><a href="../reference/auk_project.html">auk_project()</a></code>: filter to checklists collected as part of a specific project (e.g. a breeding bird survey).</li>
<li>
<code><a href="../reference/auk_time.html">auk_time()</a></code>: filter to checklists started during a range of times-of-day.</li>
<li>
<code><a href="../reference/auk_duration.html">auk_duration()</a></code>: filter to checklists with observation durations within a given range.</li>
<li>
<code><a href="../reference/auk_distance.html">auk_distance()</a></code>: filter to checklists with distances travelled within a given range.</li>
<li>
<code><a href="../reference/auk_breeding.html">auk_breeding()</a></code>: only retain observations that have an associate breeding bird atlas code.</li>
<li>
<code><a href="../reference/auk_complete.html">auk_complete()</a></code>: only retain checklists in which the observer has specified that they recorded all species seen or heard. It is necessary to retain only complete records for the creation of presence-absence data, because the “absence” information is inferred by the lack of reporting of a species on checklists.</li>
</ul>
<p>Note that all of the functions listed above only modify the <code>auk_ebd</code> object, in order to define the filters. Once the filters have been defined, the filtering is actually conducted using <code><a href="../reference/auk_filter.html">auk_filter()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">ebd_filters &lt;-<span class="st"> </span>ebd <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span><span class="co"># species: common and scientific names can be mixed</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/auk_species.html">auk_species</a></span>(<span class="dt">species =</span> <span class="kw">c</span>(<span class="st">"Gray Jay"</span>, <span class="st">"Cyanocitta cristata"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">  </span><span class="co"># country: codes and names can be mixed; case insensitive</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/auk_country.html">auk_country</a></span>(<span class="dt">country =</span> <span class="kw">c</span>(<span class="st">"US"</span>, <span class="st">"Canada"</span>, <span class="st">"mexico"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="st">  </span><span class="co"># extent: long and lat in decimal degrees</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="st">  </span><span class="co"># formatted as `c(lng_min, lat_min, lng_max, lat_max)`</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="../reference/auk_extent.html">auk_extent</a></span>(<span class="dt">extent =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>, <span class="dv">37</span>, <span class="dv">-80</span>, <span class="dv">52</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="st">  </span><span class="co"># date: use standard ISO date format `"YYYY-MM-DD"`</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="../reference/auk_date.html">auk_date</a></span>(<span class="dt">date =</span> <span class="kw">c</span>(<span class="st">"2012-01-01"</span>, <span class="st">"2012-12-31"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="st">  </span><span class="co"># time: 24h format</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="../reference/auk_time.html">auk_time</a></span>(<span class="dt">start_time =</span> <span class="kw">c</span>(<span class="st">"06:00"</span>, <span class="st">"09:00"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="st">  </span><span class="co"># duration: length in minutes of checklists</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="../reference/auk_duration.html">auk_duration</a></span>(<span class="dt">duration =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">60</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="st">  </span><span class="co"># complete: all species seen or heard are recorded</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="../reference/auk_complete.html">auk_complete</a></span>()</a>
<a class="sourceLine" id="cb9-17" data-line-number="17">ebd_filters</a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="co">#&gt; Input </span></a>
<a class="sourceLine" id="cb9-19" data-line-number="19"><span class="co">#&gt;   EBD: /Users/mes335/Library/R/3.5/library/auk/extdata/ebd-sample.txt </span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-21" data-line-number="21"><span class="co">#&gt; Output </span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22"><span class="co">#&gt;   Filters not executed</span></a>
<a class="sourceLine" id="cb9-23" data-line-number="23"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-24" data-line-number="24"><span class="co">#&gt; Filters </span></a>
<a class="sourceLine" id="cb9-25" data-line-number="25"><span class="co">#&gt;   Species: Cyanocitta cristata, Perisoreus canadensis</span></a>
<a class="sourceLine" id="cb9-26" data-line-number="26"><span class="co">#&gt;   Countries: CA, MX, US</span></a>
<a class="sourceLine" id="cb9-27" data-line-number="27"><span class="co">#&gt;   States: all</span></a>
<a class="sourceLine" id="cb9-28" data-line-number="28"><span class="co">#&gt;   BCRs: all</span></a>
<a class="sourceLine" id="cb9-29" data-line-number="29"><span class="co">#&gt;   Spatial extent: Lon -100 - -80; Lat 37 - 52</span></a>
<a class="sourceLine" id="cb9-30" data-line-number="30"><span class="co">#&gt;   Date: 2012-01-01 - 2012-12-31</span></a>
<a class="sourceLine" id="cb9-31" data-line-number="31"><span class="co">#&gt;   Start time: 06:00-09:00</span></a>
<a class="sourceLine" id="cb9-32" data-line-number="32"><span class="co">#&gt;   Last edited date: all</span></a>
<a class="sourceLine" id="cb9-33" data-line-number="33"><span class="co">#&gt;   Protocol: all</span></a>
<a class="sourceLine" id="cb9-34" data-line-number="34"><span class="co">#&gt;   Project code: all</span></a>
<a class="sourceLine" id="cb9-35" data-line-number="35"><span class="co">#&gt;   Duration: 0-60 minutes</span></a>
<a class="sourceLine" id="cb9-36" data-line-number="36"><span class="co">#&gt;   Distance travelled: all</span></a>
<a class="sourceLine" id="cb9-37" data-line-number="37"><span class="co">#&gt;   Records with breeding codes only: no</span></a>
<a class="sourceLine" id="cb9-38" data-line-number="38"><span class="co">#&gt;   Complete checklists only: yes</span></a></code></pre></div>
<p>In all cases, extensive checks are performed to ensure filters are valid. For example, species are checked against the official <a href="http://help.ebird.org/customer/portal/articles/1006825-the-ebird-taxonomy">eBird taxonomy</a> and countries are checked using the <a href="https://github.com/vincentarelbundock/countrycode"><code>countrycode</code></a> package. This is particularly important because filtering is a time consuming process, so catching errors in advance can avoid several hours of wasted time.</p>
</div>
<div id="executing-filters" class="section level3">
<h3 class="hasAnchor">
<a href="#executing-filters" class="anchor"></a>Executing filters</h3>
<p>Each of the functions described in the <em>Defining filters</em> section only defines a filter. Once all of the required filters have been set, <code><a href="../reference/auk_filter.html">auk_filter()</a></code> should be used to compile them into an AWK script and execute it to produce an output file. So, as an example of bringing all of these steps together, the following commands will extract all Gray Jay and Blue Jay records from Canada and save the results to a tab-separated text file for subsequent use:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">output_file &lt;-<span class="st"> "ebd_filtered_blja-grja.txt"</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">ebd_jays &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata/ebd-sample.txt"</span>, <span class="dt">package =</span> <span class="st">"auk"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/auk_ebd.html">auk_ebd</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/auk_species.html">auk_species</a></span>(<span class="dt">species =</span> <span class="kw">c</span>(<span class="st">"Gray Jay"</span>, <span class="st">"Cyanocitta cristata"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/auk_country.html">auk_country</a></span>(<span class="dt">country =</span> <span class="st">"Canada"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/auk_filter.html">auk_filter</a></span>(<span class="dt">file =</span> output_file)</a></code></pre></div>
<p><strong>Filtering the full EBD typically takes at least a couple hours</strong>, so set it running then go grab lunch!</p>
</div>
<div id="reading" class="section level3">
<h3 class="hasAnchor">
<a href="#reading" class="anchor"></a>Reading</h3>
<p>eBird Basic Dataset files can be read with <code><a href="../reference/read_ebd.html">read_ebd()</a></code>. This is a wrapper around <code><a href="http://www.rdocumentation.org/packages/data.table/topics/fread">data.table::fread()</a></code>, <code><a href="http://www.rdocumentation.org/packages/readr/topics/read_delim">readr::read_delim()</a></code>, or <code>read.delim()</code>, depending on which packages are installed. <code><a href="../reference/read_ebd.html">read_ebd()</a></code> uses <code>stringsAsFactors = FALSE</code>, <code>quote = ""</code>, sets column classes, and converts variable names to <code>snake_case</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">system.file</span>(<span class="st">"extdata/ebd-sample.txt"</span>, <span class="dt">package =</span> <span class="st">"auk"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/read_ebd.html">read_ebd</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co">#&gt; Observations: 495</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co">#&gt; Variables: 45</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt; $ checklist_id                 &lt;chr&gt; "S38863093", "S9652135", "S114548...</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt; $ global_unique_identifier     &lt;chr&gt; "URN:CornellLabOfOrnithology:EBIR...</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt; $ last_edited_date             &lt;chr&gt; "2017-08-28 01:20:48", "2016-08-1...</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt; $ taxonomic_order              &lt;dbl&gt; 18772, 18772, 18772, 18772, 18772...</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt; $ category                     &lt;chr&gt; "species", "species", "species", ...</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt; $ common_name                  &lt;chr&gt; "Green Jay", "Green Jay", "Green ...</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt; $ scientific_name              &lt;chr&gt; "Cyanocorax yncas", "Cyanocorax y...</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt; $ observation_count            &lt;chr&gt; "4", "4", "1", "4", "5", "1", "2"...</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt; $ breeding_bird_atlas_code     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, N...</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co">#&gt; $ breeding_bird_atlas_category &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, N...</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#&gt; $ age_sex                      &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, N...</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="co">#&gt; $ country                      &lt;chr&gt; "Mexico", "Mexico", "Honduras", "...</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#&gt; $ country_code                 &lt;chr&gt; "MX", "MX", "HN", "MX", "BZ", "MX...</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="co">#&gt; $ state                        &lt;chr&gt; "Chiapas", "Yucatan", "Santa Barb...</span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="co">#&gt; $ state_code                   &lt;chr&gt; "MX-CHP", "MX-YUC", "HN-SB", "MX-...</span></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"><span class="co">#&gt; $ county                       &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, N...</span></a>
<a class="sourceLine" id="cb11-22" data-line-number="22"><span class="co">#&gt; $ county_code                  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, N...</span></a>
<a class="sourceLine" id="cb11-23" data-line-number="23"><span class="co">#&gt; $ iba_code                     &lt;chr&gt; "MX_169", "MX_183", NA, "MX_85", ...</span></a>
<a class="sourceLine" id="cb11-24" data-line-number="24"><span class="co">#&gt; $ bcr_code                     &lt;int&gt; 61, 55, NA, 48, NA, 60, 60, 60, 6...</span></a>
<a class="sourceLine" id="cb11-25" data-line-number="25"><span class="co">#&gt; $ usfws_code                   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, N...</span></a>
<a class="sourceLine" id="cb11-26" data-line-number="26"><span class="co">#&gt; $ atlas_block                  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, N...</span></a>
<a class="sourceLine" id="cb11-27" data-line-number="27"><span class="co">#&gt; $ locality                     &lt;chr&gt; "07_020_Monterrey_SD_trad_P02", "...</span></a>
<a class="sourceLine" id="cb11-28" data-line-number="28"><span class="co">#&gt; $ locality_id                  &lt;chr&gt; "L6220973", "L221497", "L1670276"...</span></a>
<a class="sourceLine" id="cb11-29" data-line-number="29"><span class="co">#&gt; $ locality_type                &lt;chr&gt; "P", "H", "P", "P", "H", "P", "P"...</span></a>
<a class="sourceLine" id="cb11-30" data-line-number="30"><span class="co">#&gt; $ latitude                     &lt;dbl&gt; 15.42520, 20.98952, 15.40257, 23....</span></a>
<a class="sourceLine" id="cb11-31" data-line-number="31"><span class="co">#&gt; $ longitude                    &lt;dbl&gt; -92.53292, -90.29965, -88.54674, ...</span></a>
<a class="sourceLine" id="cb11-32" data-line-number="32"><span class="co">#&gt; $ observation_date             &lt;date&gt; 2011-12-16, 2012-01-18, 2012-08-...</span></a>
<a class="sourceLine" id="cb11-33" data-line-number="33"><span class="co">#&gt; $ time_observations_started    &lt;chr&gt; "06:30:00", "10:00:00", "11:41:00...</span></a>
<a class="sourceLine" id="cb11-34" data-line-number="34"><span class="co">#&gt; $ observer_id                  &lt;chr&gt; "obsr313215", "obsr202655", "obsr...</span></a>
<a class="sourceLine" id="cb11-35" data-line-number="35"><span class="co">#&gt; $ sampling_event_identifier    &lt;chr&gt; "S38863093", "S9652135", "S114548...</span></a>
<a class="sourceLine" id="cb11-36" data-line-number="36"><span class="co">#&gt; $ protocol_type                &lt;chr&gt; "Stationary", "Traveling", "Stati...</span></a>
<a class="sourceLine" id="cb11-37" data-line-number="37"><span class="co">#&gt; $ protocol_code                &lt;chr&gt; "P21", "P22", "P21", "P22", "P22"...</span></a>
<a class="sourceLine" id="cb11-38" data-line-number="38"><span class="co">#&gt; $ project_code                 &lt;chr&gt; "EBIRD", "EBIRD", "EBIRD", "EBIRD...</span></a>
<a class="sourceLine" id="cb11-39" data-line-number="39"><span class="co">#&gt; $ duration_minutes             &lt;int&gt; 10, 90, 28, 120, 90, 10, 10, 10, ...</span></a>
<a class="sourceLine" id="cb11-40" data-line-number="40"><span class="co">#&gt; $ effort_distance_km           &lt;dbl&gt; NA, 6.437, NA, 17.000, 0.483, 0.2...</span></a>
<a class="sourceLine" id="cb11-41" data-line-number="41"><span class="co">#&gt; $ effort_area_ha               &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, N...</span></a>
<a class="sourceLine" id="cb11-42" data-line-number="42"><span class="co">#&gt; $ number_observers             &lt;int&gt; 1, 9, 2, NA, 10, 1, 1, 1, 1, 1, 4...</span></a>
<a class="sourceLine" id="cb11-43" data-line-number="43"><span class="co">#&gt; $ all_species_reported         &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRU...</span></a>
<a class="sourceLine" id="cb11-44" data-line-number="44"><span class="co">#&gt; $ group_identifier             &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, N...</span></a>
<a class="sourceLine" id="cb11-45" data-line-number="45"><span class="co">#&gt; $ has_media                    &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE...</span></a>
<a class="sourceLine" id="cb11-46" data-line-number="46"><span class="co">#&gt; $ approved                     &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRU...</span></a>
<a class="sourceLine" id="cb11-47" data-line-number="47"><span class="co">#&gt; $ reviewed                     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE...</span></a>
<a class="sourceLine" id="cb11-48" data-line-number="48"><span class="co">#&gt; $ reason                       &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, N...</span></a>
<a class="sourceLine" id="cb11-49" data-line-number="49"><span class="co">#&gt; $ trip_comments                &lt;chr&gt; "Plcido Martn Morales Hernndez", ...</span></a>
<a class="sourceLine" id="cb11-50" data-line-number="50"><span class="co">#&gt; $ species_comments             &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, N...</span></a></code></pre></div>
<p><code><a href="../reference/auk_filter.html">auk_filter()</a></code> returns an <code>auk_ebd</code> object with the output file paths stored in it. This <code>auk_ebd</code> object can then be passed directly to <code>auk_read()</code>, allowing for a complete pipeline. For example, we can create an <code>auk_ebd</code> object, define filters, filter with AWK, and read in the results all at once.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">output_file &lt;-<span class="st"> "ebd_filtered_blja-grja.txt"</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">ebd_df &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata/ebd-sample.txt"</span>, <span class="dt">package =</span> <span class="st">"auk"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/auk_ebd.html">auk_ebd</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/auk_species.html">auk_species</a></span>(<span class="dt">species =</span> <span class="kw">c</span>(<span class="st">"Gray Jay"</span>, <span class="st">"Cyanocitta cristata"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/auk_country.html">auk_country</a></span>(<span class="dt">country =</span> <span class="st">"Canada"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/auk_filter.html">auk_filter</a></span>(<span class="dt">file =</span> output_file) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="../reference/read_ebd.html">read_ebd</a></span>()</a></code></pre></div>
</div>
<div id="saving-the-awk-command" class="section level3">
<h3 class="hasAnchor">
<a href="#saving-the-awk-command" class="anchor"></a>Saving the AWK command</h3>
<p>The AWK script can be saved for future reference by providing an output filename to <code>awk_file</code>. In addition, by setting <code>execute = FALSE</code> the AWK script will be generated but not run.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">awk_script &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata/ebd-sample.txt"</span>, <span class="dt">package =</span> <span class="st">"auk"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/auk_ebd.html">auk_ebd</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/auk_species.html">auk_species</a></span>(<span class="dt">species =</span> <span class="kw">c</span>(<span class="st">"Gray Jay"</span>, <span class="st">"Cyanocitta cristata"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/auk_country.html">auk_country</a></span>(<span class="dt">country =</span> <span class="st">"Canada"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/auk_filter.html">auk_filter</a></span>(<span class="dt">awk_file =</span> <span class="st">"awk-script.txt"</span>, <span class="dt">execute =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co"># read back in and prepare for printing</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7">awk_file &lt;-<span class="st"> </span><span class="kw">readLines</span>(awk_script)</a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="kw">unlink</span>(<span class="st">"awk-script.txt"</span>)</a>
<a class="sourceLine" id="cb13-9" data-line-number="9">awk_file[<span class="op">!</span><span class="kw">grepl</span>(<span class="st">"^[[:space:]]*$"</span>, awk_file)] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="st">  </span><span class="kw">paste0</span>(<span class="dt">collapse =</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="st">  </span><span class="kw">cat</span>()</a>
<a class="sourceLine" id="cb13-12" data-line-number="12"><span class="co">#&gt; </span><span class="re">BEGIN</span><span class="co"> {</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="co">#&gt;   FS = OFS = "   "</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14"><span class="co">#&gt;     split("Cyanocitta cristata   Perisoreus canadensis", speciesValues, "    ")</span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="co">#&gt;     for (i in speciesValues) species[speciesValues[i]] = 1</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="co">#&gt;     split("CA", countryValues, " ")</span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17"><span class="co">#&gt;     for (i in countryValues) countries[countryValues[i]] = 1</span></a>
<a class="sourceLine" id="cb13-18" data-line-number="18"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb13-19" data-line-number="19"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb13-20" data-line-number="20"><span class="co">#&gt;   keep = 1</span></a>
<a class="sourceLine" id="cb13-21" data-line-number="21"><span class="co">#&gt;   # filters</span></a>
<a class="sourceLine" id="cb13-22" data-line-number="22"><span class="co">#&gt;   if (keep == 1 &amp;&amp; ($6 in species)) {</span></a>
<a class="sourceLine" id="cb13-23" data-line-number="23"><span class="co">#&gt;     keep = 1</span></a>
<a class="sourceLine" id="cb13-24" data-line-number="24"><span class="co">#&gt;   } else {</span></a>
<a class="sourceLine" id="cb13-25" data-line-number="25"><span class="co">#&gt;     keep = 0</span></a>
<a class="sourceLine" id="cb13-26" data-line-number="26"><span class="co">#&gt;   }</span></a>
<a class="sourceLine" id="cb13-27" data-line-number="27"><span class="co">#&gt;   if (keep == 1 &amp;&amp; ($14 in countries)) {</span></a>
<a class="sourceLine" id="cb13-28" data-line-number="28"><span class="co">#&gt;     keep = 1</span></a>
<a class="sourceLine" id="cb13-29" data-line-number="29"><span class="co">#&gt;   } else {</span></a>
<a class="sourceLine" id="cb13-30" data-line-number="30"><span class="co">#&gt;     keep = 0</span></a>
<a class="sourceLine" id="cb13-31" data-line-number="31"><span class="co">#&gt;   }</span></a>
<a class="sourceLine" id="cb13-32" data-line-number="32"><span class="co">#&gt;   # keeps header</span></a>
<a class="sourceLine" id="cb13-33" data-line-number="33"><span class="co">#&gt;   if (NR == 1) {</span></a>
<a class="sourceLine" id="cb13-34" data-line-number="34"><span class="co">#&gt;     keep = 1</span></a>
<a class="sourceLine" id="cb13-35" data-line-number="35"><span class="co">#&gt;   }</span></a>
<a class="sourceLine" id="cb13-36" data-line-number="36"><span class="co">#&gt;   if (keep == 1) {</span></a>
<a class="sourceLine" id="cb13-37" data-line-number="37"><span class="co">#&gt;     print $0</span></a>
<a class="sourceLine" id="cb13-38" data-line-number="38"><span class="co">#&gt;   }</span></a>
<a class="sourceLine" id="cb13-39" data-line-number="39"><span class="co">#&gt; }</span></a></code></pre></div>
</div>
<div id="group-checklists" class="section level3">
<h3 class="hasAnchor">
<a href="#group-checklists" class="anchor"></a>Group checklists</h3>
<p>eBird allows observers birding together to share checklists. This process creates a new copy of the original checklist for each observer with whom the original checklist was shared; these copies can then be tweaked to add or remove some species that weren’t seen by the entire group, or altering the sampling-event data. For most applications, it’s best to remove these duplicate (or near-duplicate) checklists. <code><a href="../reference/auk_unique.html">auk_unique()</a></code> removes duplicates resulting from group checklists by selecting the observation with the lowest <code>sampling_event_identifier</code> (a unique ID for each checklist); this is the original checklists from which shared copies were generated. In addition to removing duplicates, a <code>checklist_id</code> field is added, which is equal to the <code>sampling_event_identifier</code> for non-group checklists and the <code>group_identifier</code> for grouped checklists. After running <code><a href="../reference/auk_unique.html">auk_unique()</a></code>, every species will have a single entry for each <code>checklist_id</code>.</p>
<p><code><a href="../reference/read_ebd.html">read_ebd()</a></code> automatically runs <code><a href="../reference/auk_unique.html">auk_unique()</a></code>, however, we can use <code>unique = FALSE</code> then manually run <code><a href="../reference/auk_unique.html">auk_unique()</a></code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># read in an ebd file and don't automatically remove duplicates</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">ebd_dupes &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata/ebd-sample.txt"</span>, <span class="dt">package =</span> <span class="st">"auk"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/read_ebd.html">read_ebd</a></span>(<span class="dt">unique =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co"># remove duplicates</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5">ebd_unique &lt;-<span class="st"> </span><span class="kw"><a href="../reference/auk_unique.html">auk_unique</a></span>(ebd_dupes)</a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="co"># compare number of rows</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="kw">nrow</span>(ebd_dupes)</a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="co">#&gt; [1] 500</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="kw">nrow</span>(ebd_unique)</a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">#&gt; [1] 495</span></a></code></pre></div>
</div>
<div id="taxonomic-rollup" class="section level3">
<h3 class="hasAnchor">
<a href="#taxonomic-rollup" class="anchor"></a>Taxonomic rollup</h3>
<p>The eBird Basic Dataset includes both true species and other taxa, including domestics, hybrids, subspecies, “spuhs”, and recognizable forms. In some cases, a checklist may contain multiple records for the same species, for example, both Audubon’s and Myrtle Yellow-rumped Warblers, as well as some records that are not resolvable to species, for example, “warbler sp.”. For most use cases, a single record for each species on each checklist is desired. The function <code>ebd_rollup()</code> addresses these cases by removing taxa not identifiable to species and rolling up taxa identified below species level to a single record for each species in each checklist.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># read in sample data without rolling up</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">ebd &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata/ebd-rollup-ex.txt"</span>, <span class="dt">package =</span> <span class="st">"auk"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/read_ebd.html">read_ebd</a></span>(<span class="dt">rollup =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co"># apply roll up</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5">ebd_ru &lt;-<span class="st"> </span><span class="kw"><a href="../reference/auk_rollup.html">auk_rollup</a></span>(ebd)</a>
<a class="sourceLine" id="cb15-6" data-line-number="6"></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="co"># all taxa not identifiable to species are dropped</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="co"># taxa below species have been rolled up to species</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="kw">unique</span>(ebd<span class="op">$</span>category)</a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="co">#&gt; [1] "domestic"   "form"       "hybrid"     "intergrade" "slash"     </span></a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="co">#&gt; [6] "spuh"       "issf"       "species"</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12"><span class="kw">unique</span>(ebd_ru<span class="op">$</span>category)</a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="co">#&gt; [1] "species"</span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14"></a>
<a class="sourceLine" id="cb15-15" data-line-number="15"><span class="co"># yellow-rump warbler subspecies rollup</span></a>
<a class="sourceLine" id="cb15-16" data-line-number="16"><span class="co"># without rollup, there are three observations</span></a>
<a class="sourceLine" id="cb15-17" data-line-number="17">ebd <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-18" data-line-number="18"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(common_name <span class="op">==</span><span class="st"> "Yellow-rumped Warbler"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-19" data-line-number="19"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(checklist_id, category, common_name, subspecies_common_name,</a>
<a class="sourceLine" id="cb15-20" data-line-number="20">         observation_count)</a>
<a class="sourceLine" id="cb15-21" data-line-number="21"><span class="co">#&gt; # A tibble: 5 x 5</span></a>
<a class="sourceLine" id="cb15-22" data-line-number="22"><span class="co">#&gt;   checklist_id category  common_name  subspecies_common_… observation_cou…</span></a>
<a class="sourceLine" id="cb15-23" data-line-number="23"><span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;               &lt;chr&gt;           </span></a>
<a class="sourceLine" id="cb15-24" data-line-number="24"><span class="co">#&gt; 1 S45216549    intergra… Yellow-rump… Yellow-rumped Warb… 3               </span></a>
<a class="sourceLine" id="cb15-25" data-line-number="25"><span class="co">#&gt; 2 S45115209    intergra… Yellow-rump… Yellow-rumped Warb… 1               </span></a>
<a class="sourceLine" id="cb15-26" data-line-number="26"><span class="co">#&gt; 3 S33053360    issf      Yellow-rump… Yellow-rumped Warb… 2               </span></a>
<a class="sourceLine" id="cb15-27" data-line-number="27"><span class="co">#&gt; 4 S33053360    issf      Yellow-rump… Yellow-rumped Warb… 1               </span></a>
<a class="sourceLine" id="cb15-28" data-line-number="28"><span class="co">#&gt; 5 S33053360    species   Yellow-rump… &lt;NA&gt;                2</span></a>
<a class="sourceLine" id="cb15-29" data-line-number="29"><span class="co"># with rollup, they have been combined</span></a>
<a class="sourceLine" id="cb15-30" data-line-number="30">ebd_ru <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-31" data-line-number="31"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(common_name <span class="op">==</span><span class="st"> "Yellow-rumped Warbler"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-32" data-line-number="32"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(checklist_id, category, common_name, observation_count)</a>
<a class="sourceLine" id="cb15-33" data-line-number="33"><span class="co">#&gt; # A tibble: 3 x 4</span></a>
<a class="sourceLine" id="cb15-34" data-line-number="34"><span class="co">#&gt;   checklist_id category common_name           observation_count</span></a>
<a class="sourceLine" id="cb15-35" data-line-number="35"><span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;    &lt;chr&gt;                 &lt;chr&gt;            </span></a>
<a class="sourceLine" id="cb15-36" data-line-number="36"><span class="co">#&gt; 1 S45216549    species  Yellow-rumped Warbler 3                </span></a>
<a class="sourceLine" id="cb15-37" data-line-number="37"><span class="co">#&gt; 2 S45115209    species  Yellow-rumped Warbler 1                </span></a>
<a class="sourceLine" id="cb15-38" data-line-number="38"><span class="co">#&gt; 3 S33053360    species  Yellow-rumped Warbler 5</span></a></code></pre></div>
<p>By default, <code><a href="../reference/read_ebd.html">read_ebd()</a></code> calls <code>ebd_rollup()</code> when importing an eBird Basic Dataset file. To avoid this, and retain subspecies, use <code><a href="../reference/read_ebd.html">read_ebd(rollup = FALSE)</a></code>.</p>
</div>
</div>
<div id="zero-filled-presence-absence-data" class="section level2">
<h2 class="hasAnchor">
<a href="#zero-filled-presence-absence-data" class="anchor"></a>Zero-filled, presence-absence data</h2>
<p>For many applications, presence-only data are sufficient; however, for modeling and analysis, presence-absence data are required. eBird observers only explicitly collect presence data, but they have the option of flagging their checklist as “complete” meaning that they are reporting all the species they saw or heard, and identified. Therefore, given a list of positive sightings (the basic dataset) and a list of all checklists (the sampling event data) it is possible to infer absences by filling zeros for all species not explicitly reported. This section of the vignette describes functions for producing zero-filled, presence-absence data.</p>
<div id="filtering" class="section level3">
<h3 class="hasAnchor">
<a href="#filtering" class="anchor"></a>Filtering</h3>
<p>When preparing to create zero-filled data, the eBird Basic Dataset and sampling event data must be filtered to the same set of checklists to ensure consistency. To ensure these two datasets are synced, provide <em>both</em> to <code>auk_ebd</code>, then filter as described in the previous section. This will ensure that all the filters applied to the ebd (except species) will be applied to the sampling event data so that we’ll be working with the same set of checklists. It is critical that <code>auk_compete()</code> is called, since complete checklists are a requirement for zero-filling.</p>
<p>For example, the following filters to only include sightings of Collared Kingfisher between 6 and 10am:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co"># to produce zero-filled data, provide an EBD and sampling event data file</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">f_ebd &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata/zerofill-ex_ebd.txt"</span>, <span class="dt">package =</span> <span class="st">"auk"</span>)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">f_smp &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata/zerofill-ex_sampling.txt"</span>, <span class="dt">package =</span> <span class="st">"auk"</span>)</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">filters &lt;-<span class="st"> </span><span class="kw"><a href="../reference/auk_ebd.html">auk_ebd</a></span>(f_ebd, <span class="dt">file_sampling =</span> f_smp) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/auk_species.html">auk_species</a></span>(<span class="st">"Collared Kingfisher"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/auk_time.html">auk_time</a></span>(<span class="kw">c</span>(<span class="st">"06:00"</span>, <span class="st">"10:00"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="../reference/auk_complete.html">auk_complete</a></span>()</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">filters</a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="co">#&gt; Input </span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="co">#&gt;   EBD: /Users/mes335/Library/R/3.5/library/auk/extdata/zerofill-ex_ebd.txt </span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="co">#&gt;   Sampling events: /Users/mes335/Library/R/3.5/library/auk/extdata/zerofill-ex_sampling.txt </span></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="co">#&gt; Output </span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14"><span class="co">#&gt;   Filters not executed</span></a>
<a class="sourceLine" id="cb16-15" data-line-number="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-16" data-line-number="16"><span class="co">#&gt; Filters </span></a>
<a class="sourceLine" id="cb16-17" data-line-number="17"><span class="co">#&gt;   Species: Todiramphus chloris</span></a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="co">#&gt;   Countries: all</span></a>
<a class="sourceLine" id="cb16-19" data-line-number="19"><span class="co">#&gt;   States: all</span></a>
<a class="sourceLine" id="cb16-20" data-line-number="20"><span class="co">#&gt;   BCRs: all</span></a>
<a class="sourceLine" id="cb16-21" data-line-number="21"><span class="co">#&gt;   Spatial extent: full extent</span></a>
<a class="sourceLine" id="cb16-22" data-line-number="22"><span class="co">#&gt;   Date: all</span></a>
<a class="sourceLine" id="cb16-23" data-line-number="23"><span class="co">#&gt;   Start time: 06:00-10:00</span></a>
<a class="sourceLine" id="cb16-24" data-line-number="24"><span class="co">#&gt;   Last edited date: all</span></a>
<a class="sourceLine" id="cb16-25" data-line-number="25"><span class="co">#&gt;   Protocol: all</span></a>
<a class="sourceLine" id="cb16-26" data-line-number="26"><span class="co">#&gt;   Project code: all</span></a>
<a class="sourceLine" id="cb16-27" data-line-number="27"><span class="co">#&gt;   Duration: all</span></a>
<a class="sourceLine" id="cb16-28" data-line-number="28"><span class="co">#&gt;   Distance travelled: all</span></a>
<a class="sourceLine" id="cb16-29" data-line-number="29"><span class="co">#&gt;   Records with breeding codes only: no</span></a>
<a class="sourceLine" id="cb16-30" data-line-number="30"><span class="co">#&gt;   Complete checklists only: yes</span></a></code></pre></div>
<p>As with presence-only data, call <code><a href="../reference/auk_filter.html">auk_filter()</a></code> to actually run AWK. Output files must be provided for both the EBD and sampling event data.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">## ebd_sed_filtered &lt;- auk_filter(filters, </a>
<a class="sourceLine" id="cb17-2" data-line-number="2">##                                file = "ebd-filtered.txt",</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">##                                file_sampling = "sampling-filtered.txt")</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">ebd_sed_filtered</a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="co">#&gt; Input </span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="co">#&gt;   EBD: /Users/mes335/Library/R/3.5/library/auk/extdata/zerofill-ex_ebd.txt </span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="co">#&gt;   Sampling events: /Users/mes335/Library/R/3.5/library/auk/extdata/zerofill-ex_sampling.txt </span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="co">#&gt; Output </span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="co">#&gt;   EBD: ebd-filtered.txt </span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="co">#&gt;   Sampling events: sampling-filtered.txt </span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-13" data-line-number="13"><span class="co">#&gt; Filters </span></a>
<a class="sourceLine" id="cb17-14" data-line-number="14"><span class="co">#&gt;   Species: Todiramphus chloris</span></a>
<a class="sourceLine" id="cb17-15" data-line-number="15"><span class="co">#&gt;   Countries: all</span></a>
<a class="sourceLine" id="cb17-16" data-line-number="16"><span class="co">#&gt;   States: all</span></a>
<a class="sourceLine" id="cb17-17" data-line-number="17"><span class="co">#&gt;   BCRs: all</span></a>
<a class="sourceLine" id="cb17-18" data-line-number="18"><span class="co">#&gt;   Spatial extent: full extent</span></a>
<a class="sourceLine" id="cb17-19" data-line-number="19"><span class="co">#&gt;   Date: all</span></a>
<a class="sourceLine" id="cb17-20" data-line-number="20"><span class="co">#&gt;   Start time: 06:00-10:00</span></a>
<a class="sourceLine" id="cb17-21" data-line-number="21"><span class="co">#&gt;   Last edited date: all</span></a>
<a class="sourceLine" id="cb17-22" data-line-number="22"><span class="co">#&gt;   Protocol: all</span></a>
<a class="sourceLine" id="cb17-23" data-line-number="23"><span class="co">#&gt;   Project code: all</span></a>
<a class="sourceLine" id="cb17-24" data-line-number="24"><span class="co">#&gt;   Duration: all</span></a>
<a class="sourceLine" id="cb17-25" data-line-number="25"><span class="co">#&gt;   Distance travelled: all</span></a>
<a class="sourceLine" id="cb17-26" data-line-number="26"><span class="co">#&gt;   Records with breeding codes only: no</span></a>
<a class="sourceLine" id="cb17-27" data-line-number="27"><span class="co">#&gt;   Complete checklists only: yes</span></a></code></pre></div>
</div>
<div id="reading-and-zero-filling" class="section level3">
<h3 class="hasAnchor">
<a href="#reading-and-zero-filling" class="anchor"></a>Reading and zero-filling</h3>
<p>The filtered datasets can now be combined into a zero-filled, presence-absence dataset using <code><a href="../reference/auk_zerofill.html">auk_zerofill()</a></code>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">## ebd_zf &lt;- auk_zerofill(ebd_sed_filtered)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">ebd_zf</a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="co">#&gt; Zero-filled EBD: 181 unique checklists, for 1 species.</span></a></code></pre></div>
<p>Filenames or data frames of the basic dataset and sampling event data can also be passed to <code><a href="../reference/auk_zerofill.html">auk_zerofill()</a></code>; see the documentation for these cases. By default, <code><a href="../reference/auk_zerofill.html">auk_zerofill()</a></code> returns an <code>auk_zerofill</code> object consisting of two data frames that can be linked by a common <code>checklist_id</code> field:</p>
<ul>
<li>
<code>ebd_zf$sampling_events</code> contains the checklist information</li>
<li>
<code>ebd_zf$observations</code> contains the species counts and a binary presence-absence variable</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">head</span>(ebd_zf<span class="op">$</span>observations)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="co">#&gt; # A tibble: 6 x 4</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="co">#&gt;   checklist_id scientific_name     observation_count species_observed</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;               &lt;chr&gt;             &lt;lgl&gt;           </span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="co">#&gt; 1 G1733362     Todiramphus chloris X                 TRUE            </span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6"><span class="co">#&gt; 2 G2469935     Todiramphus chloris 0                 FALSE           </span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="co">#&gt; 3 G2469959     Todiramphus chloris 0                 FALSE           </span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="co">#&gt; 4 G2469960     Todiramphus chloris 1                 TRUE            </span></a>
<a class="sourceLine" id="cb19-9" data-line-number="9"><span class="co">#&gt; 5 G2469973     Todiramphus chloris 1                 TRUE            </span></a>
<a class="sourceLine" id="cb19-10" data-line-number="10"><span class="co">#&gt; 6 G2470208     Todiramphus chloris 0                 FALSE</span></a>
<a class="sourceLine" id="cb19-11" data-line-number="11"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(ebd_zf<span class="op">$</span>sampling_events)</a>
<a class="sourceLine" id="cb19-12" data-line-number="12"><span class="co">#&gt; Observations: 181</span></a>
<a class="sourceLine" id="cb19-13" data-line-number="13"><span class="co">#&gt; Variables: 31</span></a>
<a class="sourceLine" id="cb19-14" data-line-number="14"><span class="co">#&gt; $ checklist_id              &lt;chr&gt; "S9791113", "S9776533", "S9628006", ...</span></a>
<a class="sourceLine" id="cb19-15" data-line-number="15"><span class="co">#&gt; $ last_edited_date          &lt;chr&gt; "2017-05-27 10:36:01", "2017-05-27 1...</span></a>
<a class="sourceLine" id="cb19-16" data-line-number="16"><span class="co">#&gt; $ country                   &lt;chr&gt; "Singapore", "Singapore", "Singapore...</span></a>
<a class="sourceLine" id="cb19-17" data-line-number="17"><span class="co">#&gt; $ country_code              &lt;chr&gt; "SG", "SG", "SG", "SG", "SG", "SG", ...</span></a>
<a class="sourceLine" id="cb19-18" data-line-number="18"><span class="co">#&gt; $ state                     &lt;chr&gt; "Singapore", "Singapore", "Singapore...</span></a>
<a class="sourceLine" id="cb19-19" data-line-number="19"><span class="co">#&gt; $ state_code                &lt;chr&gt; "SG-", "SG-", "SG-", "SG-", "SG-", "...</span></a>
<a class="sourceLine" id="cb19-20" data-line-number="20"><span class="co">#&gt; $ county                    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, ...</span></a>
<a class="sourceLine" id="cb19-21" data-line-number="21"><span class="co">#&gt; $ county_code               &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, ...</span></a>
<a class="sourceLine" id="cb19-22" data-line-number="22"><span class="co">#&gt; $ iba_code                  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, ...</span></a>
<a class="sourceLine" id="cb19-23" data-line-number="23"><span class="co">#&gt; $ bcr_code                  &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, ...</span></a>
<a class="sourceLine" id="cb19-24" data-line-number="24"><span class="co">#&gt; $ usfws_code                &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, ...</span></a>
<a class="sourceLine" id="cb19-25" data-line-number="25"><span class="co">#&gt; $ atlas_block               &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, ...</span></a>
<a class="sourceLine" id="cb19-26" data-line-number="26"><span class="co">#&gt; $ locality                  &lt;chr&gt; "SG--NTU campus", "SG--NTU campus", ...</span></a>
<a class="sourceLine" id="cb19-27" data-line-number="27"><span class="co">#&gt; $ locality_id               &lt;chr&gt; "L1361109", "L1361109", "L1361109", ...</span></a>
<a class="sourceLine" id="cb19-28" data-line-number="28"><span class="co">#&gt; $ locality_type             &lt;chr&gt; "P", "P", "P", "P", "P", "P", "P", "...</span></a>
<a class="sourceLine" id="cb19-29" data-line-number="29"><span class="co">#&gt; $ latitude                  &lt;dbl&gt; 1.348154, 1.348154, 1.348154, 1.3481...</span></a>
<a class="sourceLine" id="cb19-30" data-line-number="30"><span class="co">#&gt; $ longitude                 &lt;dbl&gt; 103.6851, 103.6851, 103.6851, 103.68...</span></a>
<a class="sourceLine" id="cb19-31" data-line-number="31"><span class="co">#&gt; $ observation_date          &lt;date&gt; 2012-02-09, 2012-02-07, 2012-01-19,...</span></a>
<a class="sourceLine" id="cb19-32" data-line-number="32"><span class="co">#&gt; $ time_observations_started &lt;chr&gt; "08:15:00", "08:15:00", "08:00:00", ...</span></a>
<a class="sourceLine" id="cb19-33" data-line-number="33"><span class="co">#&gt; $ observer_id               &lt;chr&gt; "obs205759", "obs205759", "obs205759...</span></a>
<a class="sourceLine" id="cb19-34" data-line-number="34"><span class="co">#&gt; $ sampling_event_identifier &lt;chr&gt; "S9791113", "S9776533", "S9628006", ...</span></a>
<a class="sourceLine" id="cb19-35" data-line-number="35"><span class="co">#&gt; $ protocol_type             &lt;chr&gt; "Incidental", "Incidental", "Inciden...</span></a>
<a class="sourceLine" id="cb19-36" data-line-number="36"><span class="co">#&gt; $ protocol_code             &lt;chr&gt; "P20", "P20", "P20", "P20", "P20", "...</span></a>
<a class="sourceLine" id="cb19-37" data-line-number="37"><span class="co">#&gt; $ project_code              &lt;chr&gt; "EBIRD_CAN", "EBIRD_CAN", "EBIRD_CAN...</span></a>
<a class="sourceLine" id="cb19-38" data-line-number="38"><span class="co">#&gt; $ duration_minutes          &lt;int&gt; NA, NA, NA, NA, NA, 25, NA, NA, 240,...</span></a>
<a class="sourceLine" id="cb19-39" data-line-number="39"><span class="co">#&gt; $ effort_distance_km        &lt;dbl&gt; NA, NA, NA, NA, NA, 0.200, NA, NA, 3...</span></a>
<a class="sourceLine" id="cb19-40" data-line-number="40"><span class="co">#&gt; $ effort_area_ha            &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, ...</span></a>
<a class="sourceLine" id="cb19-41" data-line-number="41"><span class="co">#&gt; $ number_observers          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 12, 1, 2, 1,...</span></a>
<a class="sourceLine" id="cb19-42" data-line-number="42"><span class="co">#&gt; $ all_species_reported      &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, ...</span></a>
<a class="sourceLine" id="cb19-43" data-line-number="43"><span class="co">#&gt; $ group_identifier          &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, ...</span></a>
<a class="sourceLine" id="cb19-44" data-line-number="44"><span class="co">#&gt; $ trip_comments             &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, ...</span></a></code></pre></div>
<p>This format is efficient for storage because the checklist information isn’t duplicated, however, a single flat data frame is often required for analysis. To collapse the two data frames together use <code><a href="../reference/auk_zerofill.html">collapse_zerofill()</a></code>, or call <code><a href="../reference/auk_zerofill.html">auk_zerofill()</a></code> with <code>collapse = TRUE</code>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">## ebd_zf_df &lt;- auk_zerofill(ebd_filtered, collapse = TRUE)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">ebd_zf_df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/auk_zerofill.html">collapse_zerofill</a></span>(ebd_zf)</a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="kw">class</span>(ebd_zf_df)</a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="co">#&gt; [1] "tbl_df"     "tbl"        "data.frame"</span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5">ebd_zf_df</a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="co">#&gt; # A tibble: 181 x 34</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="co">#&gt;    checklist_id last_edited_date country country_code state state_code</span></a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;            &lt;chr&gt;   &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;     </span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="co">#&gt;  1 S9791113     2017-05-27 10:3… Singap… SG           Sing… SG-       </span></a>
<a class="sourceLine" id="cb20-10" data-line-number="10"><span class="co">#&gt;  2 S9776533     2017-05-27 10:3… Singap… SG           Sing… SG-       </span></a>
<a class="sourceLine" id="cb20-11" data-line-number="11"><span class="co">#&gt;  3 S9628006     2017-05-27 10:3… Singap… SG           Sing… SG-       </span></a>
<a class="sourceLine" id="cb20-12" data-line-number="12"><span class="co">#&gt;  4 S9598822     2017-05-27 10:3… Singap… SG           Sing… SG-       </span></a>
<a class="sourceLine" id="cb20-13" data-line-number="13"><span class="co">#&gt;  5 S10532644    2017-05-27 10:2… Singap… SG           Sing… SG-       </span></a>
<a class="sourceLine" id="cb20-14" data-line-number="14"><span class="co">#&gt;  6 S10615620    2017-10-19 12:4… Singap… SG           Sing… SG-       </span></a>
<a class="sourceLine" id="cb20-15" data-line-number="15"><span class="co">#&gt;  7 S9732235     2018-04-15 11:3… Singap… SG           Sing… SG-       </span></a>
<a class="sourceLine" id="cb20-16" data-line-number="16"><span class="co">#&gt;  8 S10440230    2012-04-13 22:0… Singap… SG           Sing… SG-       </span></a>
<a class="sourceLine" id="cb20-17" data-line-number="17"><span class="co">#&gt;  9 S9811595     2017-07-05 13:1… Singap… SG           Sing… SG-       </span></a>
<a class="sourceLine" id="cb20-18" data-line-number="18"><span class="co">#&gt; 10 S9829900     2013-09-11 12:2… Singap… SG           Sing… SG-       </span></a>
<a class="sourceLine" id="cb20-19" data-line-number="19"><span class="co">#&gt; # ... with 171 more rows, and 28 more variables: county &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb20-20" data-line-number="20"><span class="co">#&gt; #   county_code &lt;chr&gt;, iba_code &lt;chr&gt;, bcr_code &lt;int&gt;, usfws_code &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb20-21" data-line-number="21"><span class="co">#&gt; #   atlas_block &lt;chr&gt;, locality &lt;chr&gt;, locality_id &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb20-22" data-line-number="22"><span class="co">#&gt; #   locality_type &lt;chr&gt;, latitude &lt;dbl&gt;, longitude &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb20-23" data-line-number="23"><span class="co">#&gt; #   observation_date &lt;date&gt;, time_observations_started &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb20-24" data-line-number="24"><span class="co">#&gt; #   observer_id &lt;chr&gt;, sampling_event_identifier &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb20-25" data-line-number="25"><span class="co">#&gt; #   protocol_type &lt;chr&gt;, protocol_code &lt;chr&gt;, project_code &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb20-26" data-line-number="26"><span class="co">#&gt; #   duration_minutes &lt;int&gt;, effort_distance_km &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb20-27" data-line-number="27"><span class="co">#&gt; #   effort_area_ha &lt;dbl&gt;, number_observers &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb20-28" data-line-number="28"><span class="co">#&gt; #   all_species_reported &lt;lgl&gt;, group_identifier &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb20-29" data-line-number="29"><span class="co">#&gt; #   trip_comments &lt;chr&gt;, scientific_name &lt;chr&gt;, observation_count &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb20-30" data-line-number="30"><span class="co">#&gt; #   species_observed &lt;lgl&gt;</span></a></code></pre></div>
</div>
</div>
<div id="acknowledgements" class="section level2">
<h2 class="hasAnchor">
<a href="#acknowledgements" class="anchor"></a>Acknowledgements</h2>
<p>This package is based on the AWK scripts provided in a presentation given by Wesley Hochachka, Daniel Fink, Tom Auer, and Frank La Sorte at the 2016 NAOC eBird Data Workshop on August 15, 2016.</p>
<p><code>auk</code> benefited significantly from the <a href="https://ropensci.org/">rOpenSci</a> review process, including helpful suggestions from <a href="https://github.com/aurielfournier">Auriel Fournier</a> and <a href="https://github.com/emhart">Edmund Hart</a>.</p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<pre><code>eBird Basic Dataset. Version: ebd_relFeb-2018. Cornell Lab of Ornithology, Ithaca, New York. May 2013.

Guillera-Arroita, G., J.J. Lahoz-Monfort, J. Elith, A. Gordon, H. Kujala, P.E. Lentini, M.A. McCarthy, R. Tingley, and B.A. Wintle. 2015. Is my species distribution model fit for purpose? Matching data and models to applications. Global Ecology and Biogeography 24:276-292.</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#quick-start">Quick start</a></li>
      <li><a href="#background">Background</a></li>
      <li><a href="#auk-vs--rebird"><code>auk</code> vs. <code>rebird</code></a></li>
      <li><a href="#presence-data">Presence data</a></li>
      <li><a href="#zero-filled-presence-absence-data">Zero-filled, presence-absence data</a></li>
      <li><a href="#acknowledgements">Acknowledgements</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://strimas.com">Matthew Strimas-Mackey</a>, <a href="http://eliotmiller.weebly.com/">Eliot Miller</a>, Wesley Hochachka.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
